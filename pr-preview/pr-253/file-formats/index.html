<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="venvstacks File Formats - venvstacks Documentation" name="og:title" />
<meta content="website" name="og:type" />
<meta content="https://venvstacks.lmstudio.ai/stack-format/" name="og:url" />
<meta content="venvstacks Specification and Metadata File Formats - venvstacks Documentation" name="og:description" />
<link rel="search" title="Search" href="../search/" /><link rel="next" title="Design Discussion" href="../design/" /><link rel="prev" title="Essential Terms and Concepts" href="../glossary/" />
        <link rel="canonical" href="https://venvstacks.lmstudio.ai/file-formats/" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>Environment Stack File Formats - venvstacks documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../"><div class="brand">venvstacks documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../">
  
  <span class="sidebar-brand-text">venvstacks documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/">Essential Terms and Concepts</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Environment Stack File Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/">Design Discussion</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/">Python API</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Python API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/cli/">venvstacks.cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/pack_venv/">venvstacks.pack_venv</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/stacks/">venvstacks.stacks</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of venvstacks.stacks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.StackSpec/">venvstacks.stacks.StackSpec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.BuildEnvironment/">venvstacks.stacks.BuildEnvironment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerCategories/">venvstacks.stacks.LayerCategories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerSpecMetadata/">venvstacks.stacks.LayerSpecMetadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerVariants/">venvstacks.stacks.LayerVariants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.TargetPlatform/">venvstacks.stacks.TargetPlatform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.TargetPlatforms/">venvstacks.stacks.TargetPlatforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ArchiveBuildMetadata/">venvstacks.stacks.ArchiveBuildMetadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ArchiveBuildRequest/">venvstacks.stacks.ArchiveBuildRequest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ArchiveHashes/">venvstacks.stacks.ArchiveHashes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ArchiveMetadata/">venvstacks.stacks.ArchiveMetadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.PublishedArchivePaths/">venvstacks.stacks.PublishedArchivePaths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.StackPublishingRequest/">venvstacks.stacks.StackPublishingRequest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.StackPublishingResult/">venvstacks.stacks.StackPublishingResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerExportRequest/">venvstacks.stacks.LayerExportRequest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ExportMetadata/">venvstacks.stacks.ExportMetadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ExportedEnvironmentPaths/">venvstacks.stacks.ExportedEnvironmentPaths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.StackExportRequest/">venvstacks.stacks.StackExportRequest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerSpecBase/">venvstacks.stacks.LayerSpecBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.RuntimeSpec/">venvstacks.stacks.RuntimeSpec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayeredSpecBase/">venvstacks.stacks.LayeredSpecBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.FrameworkSpec/">venvstacks.stacks.FrameworkSpec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ApplicationSpec/">venvstacks.stacks.ApplicationSpec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerEnvBase/">venvstacks.stacks.LayerEnvBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.RuntimeEnv/">venvstacks.stacks.RuntimeEnv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayeredEnvBase/">venvstacks.stacks.LayeredEnvBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.FrameworkEnv/">venvstacks.stacks.FrameworkEnv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.ApplicationEnv/">venvstacks.stacks.ApplicationEnv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.EnvironmentLock/">venvstacks.stacks.EnvironmentLock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.EnvironmentLockMetadata/">venvstacks.stacks.EnvironmentLockMetadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.PackageIndexConfig/">venvstacks.stacks.PackageIndexConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.BuildEnvError/">venvstacks.stacks.BuildEnvError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.EnvStackError/">venvstacks.stacks.EnvStackError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/stacks/venvstacks.stacks.LayerSpecError/">venvstacks.stacks.LayerSpecError</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/lmstudio-ai/venvstacks/blob/main/docs/file-formats.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/lmstudio-ai/venvstacks/edit/main/docs/file-formats.rst" rel="edit" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="environment-stack-file-formats">
<span id="stack-specification-format"></span><h1>Environment Stack File Formats<a class="headerlink" href="#environment-stack-file-formats" title="Link to this heading">¶</a></h1>
<section id="file-naming-and-formats">
<h2>File naming and formats<a class="headerlink" href="#file-naming-and-formats" title="Link to this heading">¶</a></h2>
<p>By convention, virtual environment stacks are specified in a file named <code class="docutils literal notranslate"><span class="pre">venvstacks.toml</span></code>. This
convention is NOT enforced, so the CLI will accept any TOML file containing a correctly formatted
stack definition.</p>
<p>The package installation tool used to lock and build environments is <code class="docutils literal notranslate"><span class="pre">uv</span></code>. While the exact
configuration settings used when invoking <code class="docutils literal notranslate"><span class="pre">uv</span></code> are generated dynamically by <code class="docutils literal notranslate"><span class="pre">venvstacks</span></code>,
baseline settings may be provided via either a <code class="docutils literal notranslate"><span class="pre">venvstacks.uv.toml</span></code> file in the same folder as
the stack definition file or by defining a <code class="docutils literal notranslate"><span class="pre">[tool.uv]</span></code> table in the stack definition file. For
consistency with <code class="docutils literal notranslate"><span class="pre">uv</span></code>, if both are present, the inline table configuration settings are used and
the separate configuration file is ignored.</p>
<p>The format of the <code class="docutils literal notranslate"><span class="pre">venvstacks.uv.toml</span></code> configuration file is that described for <code class="docutils literal notranslate"><span class="pre">uv.toml</span></code> in
<a class="reference external" href="https://docs.astral.sh/uv/concepts/configuration-files/"><code class="docutils literal notranslate"><span class="pre">uv</span></code>’s tool documentation</a>. The <code class="docutils literal notranslate"><span class="pre">[tool.uv]</span></code> table supports the same settings, nested under the
<code class="docutils literal notranslate"><span class="pre">tool.uv</span></code> subtable. Many of the
<a class="reference external" href="https://docs.astral.sh/uv/reference/settings/">available configuration settings</a> are not
relevant to the <code class="docutils literal notranslate"><span class="pre">venvstacks</span></code> use case, but at least the following are expected to be applicable:</p>
<ul class="simple">
<li><p><a class="extlink-uv-config reference external" href="https://docs.astral.sh/uv/reference/settings/#index">index</a>: specifying which indexes to use for dependency resolution and retrieval</p></li>
<li><p><a class="extlink-uv-config reference external" href="https://docs.astral.sh/uv/reference/settings/#exclude-newer">exclude-newer</a>: ignore packages uploaded after the specified date</p></li>
<li><p><a class="extlink-uv-config reference external" href="https://docs.astral.sh/uv/reference/settings/#override-dependencies">override-dependencies</a>: override inaccurate or unwanted dependency declarations</p></li>
</ul>
<p>Note that the <a class="extlink-uv-config reference external" href="https://docs.astral.sh/uv/reference/settings/#sources">sources</a> setting (specifying indexes for specific packages) is NOT
supported (it may be specified, but will <a class="reference external" href="https://github.com/astral-sh/uv/issues/6772">have no effect</a>). Instead, named indexes are
referenced from the <a class="reference internal" href="#priority-indexes"><span class="std std-ref">priority indexes</span></a> setting to allow different layer
definitions to resolve packages against different indexes (such as those maintained by the
PyTorch project to provide binary builds against different library versions).</p>
<p>The default output folder for layer metadata when publishing artifacts and locally exporting
environments is called <code class="docutils literal notranslate"><span class="pre">__venvstacks__</span></code>. The platform-specific layer summary metadata
files are called <code class="docutils literal notranslate"><span class="pre">venvstacks.json</span></code> and each is written to a folder named after the target
platform in the parent metadata folder. The per-layer metadata files are written to an
<code class="docutils literal notranslate"><span class="pre">env_metadata</span></code> folder within the platform folders.
Refer to <a class="reference internal" href="#layer-metadata"><span class="std std-ref">Published layer metadata</span></a> for additional details.</p>
<p>The layer configuration metadata within deployed environments is written to
<code class="docutils literal notranslate"><span class="pre">share/venv/metadata/venvstacks_layer.json</span></code>.
Refer to <a class="reference internal" href="#deployed-layer-config"><span class="std std-ref">Deployed layer configuration</span></a> for additional details.</p>
<p>All human-edited input files are written using <a class="reference external" href="https://toml.io/">TOML</a>, as this is a file
format that combines the runtime simplicity and Unicode text compatibility of JSON with the
line-oriented human friendliness of the classic <code class="docutils literal notranslate"><span class="pre">.ini</span></code> format. It is the same config file
syntax used to define <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> when
<a class="reference external" href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/#writing-pyproject-toml" title="(in Python Packaging User Guide)"><span class="xref std std-ref">publishing Python packages</span></a>.</p>
<p>All output metadata files generated by the build process are emitted as <a class="reference external" href="https://www.json.org/">JSON</a>.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.8.0: </span>Added support for configuring <code class="docutils literal notranslate"><span class="pre">uv</span></code> execution and having it affect both locking and building
(<a class="reference internal" href="../changelog/#changelog-0-8-0"><span class="std std-ref">release details</span></a>). User and system level default <code class="docutils literal notranslate"><span class="pre">uv</span></code> configuration
settings no longer affect the behaviour of the locking process.</p>
</div>
</section>
<section id="defining-virtual-environment-stacks">
<h2>Defining virtual environment stacks<a class="headerlink" href="#defining-virtual-environment-stacks" title="Link to this heading">¶</a></h2>
<p>Virtual environment stacks are defined using the following top-level fields, which are all TOML
<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array-of-tables">arrays of tables</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[[runtimes]]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[[frameworks]]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[[applications]]</span></code></p></li>
</ul>
<section id="common-layer-specification-fields">
<h3>Common layer specification fields<a class="headerlink" href="#common-layer-specification-fields" title="Link to this heading">¶</a></h3>
<p>All layer specifications must contain the following two fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">string</a>): the name of the layer being specified</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requirements</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
the top-level Python distribution packages to be installed as part of this layer.
Dependencies are declared using the standard Python
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/dependency-specifiers/#dependency-specifiers" title="(in Python Packaging User Guide)"><span class="xref std std-ref">dependency specifier</span></a> format.
These declared dependencies will be transitively locked when locking the layer.
The list of requirements must be present, but is permitted to be empty.</p></li>
</ul>
<p>While there are no formal restrictions on the symbols permitted in layer names, it is
recommended to avoid the use of any punctuation symbols other than <code class="docutils literal notranslate"><span class="pre">_</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>
(as future releases may assign specific semantics to those symbols).
The <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol in particular is already used to separate the layer name from the lock
version for implicitly versioned layers, so using it as part of a layer name may cause
confusion when attempting to determine whether a published artifact or
exported environment is using implicit lock versioning or is referring
to an external version number.</p>
<p>All layer specifications may also contain the following optional fields:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">platforms</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
by default, all layers are built for all target platforms. Setting this field
allows the layer build to be narrowed to a subset of the supported targets.
Setting this field to an empty list also allows a layer build to be disabled
without having to delete it entirely.
Permitted entries in the <code class="docutils literal notranslate"><span class="pre">platforms</span></code> list are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;win_amd64&quot;</span></code>: Windows on x86-64</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;win_arm64&quot;</span></code>: Windows on ARM64/Aarch64 (not currently tested in CI)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;linux_x86_64&quot;</span></code>: Linux on x86_64</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;linux_aarch64&quot;</span></code>: Linux on ARM64/Aarch64 (not currently tested in CI)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;macosx_arm64&quot;</span></code>: macOS on Apple (ARM64/Aarch64) silicon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;macosx_x86_64&quot;</span></code>: macOS on Intel silicon (not currently tested in CI)</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.3.0: </span>Added <code class="docutils literal notranslate"><span class="pre">win_arm64</span></code> and <code class="docutils literal notranslate"><span class="pre">linux_aarch64</span></code> as permitted target platforms
(<a class="reference internal" href="../changelog/#changelog-0-3-0"><span class="std std-ref">release details</span></a>).</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dynlib_exclude</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
by default, dynamic library (also known as shared object) files on Linux
and macOS that do not appear to be Python extension modules will be symbolically
linked from a <code class="docutils literal notranslate"><span class="pre">share/venv/dynlib/</span></code> folder within the virtual environment
(see <a class="reference internal" href="../design/#dynamic-linking"><span class="std std-ref">How does dynamic linking work across layers?</span></a> for additional details).
Setting this field allows files to be excluded from the linking process based
on filename glob patterns. These patterns are checked against the <em>end</em> of the
full path to the files using the equivalent of <a class="reference external" href="https://docs.python.org/3/library/glob.html#glob.translate" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">glob.translate()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.4.0: </span>Added support for dynamic linking across layers on Linux and macOS
(<a class="reference internal" href="../changelog/#changelog-0-4-0"><span class="std std-ref">release details</span></a>).</p>
</div>
</li>
</ul>
<ul id="priority-indexes">
<li><p><code class="docutils literal notranslate"><span class="pre">priority_indexes</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
by default, all layers are built with common tool configuration settings. To allow different
layers to retrieve wheels from different indexes, layers may define a <code class="docutils literal notranslate"><span class="pre">priority_indexes</span></code> list
that is used to adjust the <code class="docutils literal notranslate"><span class="pre">uv</span></code> <code class="docutils literal notranslate"><span class="pre">index</span></code> configuration for that layer by moving the named
indexes to the start of the index list (in the given order) and clearing their <code class="docutils literal notranslate"><span class="pre">explicit</span></code> flag.
For example, one framework layer definition may specify <code class="docutils literal notranslate"><span class="pre">priority_indexes</span> <span class="pre">=</span> <span class="pre">[&quot;pytorch-cu128&quot;]</span></code>,
while an alternate framework definition layer may specify <code class="docutils literal notranslate"><span class="pre">priority_indexes</span> <span class="pre">=</span> <span class="pre">[&quot;pytorch-cpu&quot;]</span></code>.
Upper layers do NOT automatically inherit the index priorities of the layers they depend on
(however, they also do not install any of the packages provided by lower layers). A stack
definition error is reported if a priority index list refers to an unknown index name.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.8.0: </span>Added support for per-layer <code class="docutils literal notranslate"><span class="pre">uv</span></code> index priority configuration
(<a class="reference internal" href="../changelog/#changelog-0-8-0"><span class="std std-ref">release details</span></a>).</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">versioned</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#boolean">boolean</a>): by default, and when this setting is <code class="docutils literal notranslate"><span class="pre">false</span></code>,
the layer is considered unversioned (even if an <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol appears in the
layer name). The layer metadata will always report the lock version for these
layers as <code class="docutils literal notranslate"><span class="pre">1</span></code> and the lock version is never implicitly included when deriving
other names from the layer name.
When this setting is <code class="docutils literal notranslate"><span class="pre">true</span></code>, the layer is implicitly versioned.
For implicitly versioned layers, a lock version number is stored as part of
the environment lock metadata, and automatically incremented when the
environment lock file changes as the result of a layer locking request.
The layer metadata will report the saved lock version for implicitly versioned
layers and this value is automatically included when deriving some other names
from the layer name.</p></li>
</ul>
<p>This means the following layer versioning styles are supported:</p>
<ul class="simple">
<li><p><em>unversioned</em>: layer name uses a format like <code class="docutils literal notranslate"><span class="pre">my-app</span></code> with <code class="docutils literal notranslate"><span class="pre">versioned</span></code>
omitted or set to <code class="docutils literal notranslate"><span class="pre">false</span></code>. Dependencies from other layers (if any) refer to
the unversioned layer name. Only the latest version of an unversioned
layer can be built and published, and only one version can be installed
on any given target system. <a class="reference internal" href="#layer-metadata"><span class="std std-ref">Artifact tagging</span></a> allows
multiple versions of unversioned layers to still be distributed in parallel.
The advantage of unversioned layers is that they allow for low impact security
updates, where upper layers only need to be rebuilt if they actually depended
on an updated component.</p></li>
<li><p><em>implicitly versioned</em>: layer name uses a format like <code class="docutils literal notranslate"><span class="pre">scipy</span></code> with <code class="docutils literal notranslate"><span class="pre">versioned</span></code>
set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Dependencies from other layers refer to the unversioned layer name,
and are automatically updated to depend on the new version of the lower layer when
the locked requirements change. Some component names derived from the layer name
will be implicitly rewritten to use <code class="docutils literal notranslate"><span class="pre">&quot;{layer_name}&#64;{lock_version}&quot;</span></code> rather than
using the layer name on its own. Only the latest version of an implicitly versioned
layer can be built and published, but different versions can be installed in
parallel on target systems.
Implicitly versioned layers lose support for low impact security updates (all
upper layers must be rebuilt for any change to the implicitly versioned lower
layer), but gain support for parallel installation of multiple versions on
target systems.</p></li>
<li><p><em>externally versioned</em>: layer name uses a format like <code class="docutils literal notranslate"><span class="pre">cpython-3.12</span></code>, where
the external layer “version” is considered part of the layer name.
Dependencies from other layers must refer to the specific version.
External versioning allows upper layers to depend on different versions of
the “same” lower layer, but also requires those layers to be explicitly
migrated to new versions of the lower layer.
External versioning always allows multiple versions of the “same” layer to be
built and published in parallel.
By default, externally versioned layers are handled in the same way as
unversioned layers, but external versioning in the layer name may also be
freely combined with implicit lock versioning in the derived names by
setting <code class="docutils literal notranslate"><span class="pre">versioned</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
</ul>
<p>Refer to <a class="reference internal" href="#layer-names"><span class="std std-ref">Layer names and versioning</span></a> for additional details on how layer names are used
when building virtual environment stacks.</p>
</section>
<section id="runtime-layer-specification-fields">
<span id="runtime-layer-spec"></span><h3>Runtime layer specification fields<a class="headerlink" href="#runtime-layer-specification-fields" title="Link to this heading">¶</a></h3>
<p>Runtime layer specifications must contain the following additional field:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">python_implementation</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">string</a>): the <a class="extlink-pypi reference external" href="https://pypi.org/project/pbs-installer/">pbs-installer</a> name
of the Python runtime to be installed as the base runtime for this layer
(and any upper layers that depend on this layer). Implementation names
use the format <code class="docutils literal notranslate"><span class="pre">{implementation_name}&#64;{implementation_version}</span></code>
(for example, <code class="docutils literal notranslate"><span class="pre">cpython&#64;3.12.7</span></code>).</p></li>
</ul>
</section>
<section id="framework-layer-specification-fields">
<span id="framework-layer-spec"></span><h3>Framework layer specification fields<a class="headerlink" href="#framework-layer-specification-fields" title="Link to this heading">¶</a></h3>
<p>Framework layer specifications must contain one of the following additional fields
(but not both):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">runtime</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">string</a>): the name of the runtime layer that this framework layer uses.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frameworks</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
the names of the other framework layers that this framework layer depends on.</p></li>
</ul>
<p>When a framework layer declares a dependency on other framework layers, the <code class="docutils literal notranslate"><span class="pre">runtime</span></code>
dependency for this layer is not specified directly. Instead, all of the declared
framework dependencies <em>must</em> depend on the same runtime layer, and that base
runtime also becomes the base runtime for this framework layer. In order to
support this runtime inference step, and to prevent the declaration of circular
dependencies between layers, forward references are <em>not</em> supported (in other
words, layers must be declared <em>after</em> the layers they depend on).</p>
<p>Whether the runtime is specified directly or indirectly, the <code class="docutils literal notranslate"><span class="pre">install_target</span></code>
and <code class="docutils literal notranslate"><span class="pre">python_implementation</span></code> attributes of the runtime layer are respectively recorded
in the <code class="docutils literal notranslate"><span class="pre">runtime_layer</span></code> and <code class="docutils literal notranslate"><span class="pre">python_implementation</span></code> fields of the framework layer’s
output metadata.</p>
<p><code class="docutils literal notranslate"><span class="pre">bound_to_implementation</span></code> is an additional boolean field in the framework layer
output metadata that indicates how tightly coupled the framework layer is
to the underlying implementation layer.</p>
<p>On platforms which use symlinks between layered environments and their base
environments (any platform other than Windows), <code class="docutils literal notranslate"><span class="pre">bound_to_implementation</span></code>
will be <code class="docutils literal notranslate"><span class="pre">false</span></code>.
This allows for transparent security updates of the base runtime layer (for
example, to update to new OpenSSL versions or CPython maintenance releases),
without needing to republish the upper layers that use that base runtime.</p>
<p>On Windows, where some elements of the base runtime are copied into each
layered environment that depends on it, <code class="docutils literal notranslate"><span class="pre">bound_to_implementation</span></code> will
be <code class="docutils literal notranslate"><span class="pre">true</span></code>.
This still allows for transparent security updates of the base runtime layer
in some cases (for example, to update to new OpenSSL versions), but indicates
the upper layers will need to be rebuilt and republished for new CPython
maintenance releases.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.4.0: </span>Added the ability for framework layers to depend on other framework layers
instead of depending directly on a runtime layer
(<a class="reference internal" href="../changelog/#changelog-0-4-0"><span class="std std-ref">release details</span></a>).</p>
</div>
</section>
<section id="application-layer-specification-fields">
<span id="application-layer-spec"></span><h3>Application layer specification fields<a class="headerlink" href="#application-layer-specification-fields" title="Link to this heading">¶</a></h3>
<p>Application layer specifications must contain one of the following additional fields (but not both):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">runtime</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">string</a>): the name of the runtime layer that this application layer uses.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frameworks</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
the names of the framework layers that this application layer depends on.</p></li>
</ul>
<p>These two fields are handled in the same way as they are for
<a class="reference internal" href="#framework-layer-spec"><span class="std std-ref">framework layer specifications</span></a>.</p>
<p>Python code running in this application layer will be able to import modules from the specified
base runtime layer, and from any of the framework layers declared as dependencies (whether
directly or indirectly). Refer to <a class="reference internal" href="#layer-dependency-linearization"><span class="std std-ref">Linearizing the Python import path</span></a> for additional details
on how the relative order of the application layer <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> entries is determined.</p>
<p>Application layer specifications must also contain the following additional field:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">launch_module</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">string</a>): a relative path (starting from the folder containing
the stack specification file) that specifies a Python module or import package that will
be included in the built environment for execution with the <a class="reference external" href="https://docs.python.org/3/using/cmdline.html#cmdoption-m" title="(in Python v3.13)"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> switch.</p></li>
</ul>
<p>Application layer specifications may also contain the following optional field:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">support_modules</span></code> (<a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#array">array</a> of <a class="extlink-toml reference external" href="https://toml.io/en/v1.0.0#string">strings</a>):
an array of relative paths (each starting from the folder containing the stack specification
file) that specify Python modules or import packages that will be included in the built
environment for use by the application launch module.</p></li>
</ul>
<p>Refer to <a class="reference internal" href="#source-tree-content-filtering"><span class="std std-ref">Source tree content filtering</span></a> for details on exactly which files will be
included in the application layer from referenced launch modules and support modules.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.4.0: </span>Added the ability for application layers to depend directly on a runtime layer instead
of declaring that they depend on one or more framework layers
(<a class="reference internal" href="../changelog/#changelog-0-4-0"><span class="std std-ref">release details</span></a>).</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>Updating the name or contents of a launch module also updates the layer version
for implicitly versioned layers
(<a class="reference internal" href="../changelog/#changelog-0-5-0"><span class="std std-ref">release details</span></a>).</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.6.0: </span>Added the <code class="docutils literal notranslate"><span class="pre">support_modules</span></code> field (<a class="reference internal" href="../changelog/#changelog-0-6-0"><span class="std std-ref">release details</span></a>).</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.6.0: </span>Source tree content filtering for launch modules and support modules
(<a class="reference internal" href="../changelog/#changelog-0-6-0"><span class="std std-ref">release details</span></a>).</p>
</div>
</section>
<section id="linearizing-the-python-import-path">
<span id="layer-dependency-linearization"></span><h3>Linearizing the Python import path<a class="headerlink" href="#linearizing-the-python-import-path" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">venvstacks.toml</span></code> file format allows the declared dependencies between framework
layers to form a directed acyclic graph (DAG). Python’s import system requires that
this graph be flattened into a list in order to be able to define the relative order
of application layer <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> entries in a consistent fashion.</p>
<p>This linearization problem is similar to the one that Python itself needs to solve when
determining how to resolve attribute lookups on Python classes in the presence of multiple
inheritance, and <code class="docutils literal notranslate"><span class="pre">venvstacks</span></code> intentionally uses the same solution: the C3 linearization
algorithm described in this article about the
<a class="reference external" href="https://www.python.org/download/releases/2.3/mro/">Python 2.3 Method Resolution Order</a>.</p>
<p>In simple cases where the only common point in the declared layer dependencies is the base
runtime, this algorithm gives the same result as a depth-first left-to-right resolution of
the declared dependencies.</p>
<p>The benefit of the more complex linearization arises in more complex cases, where the C3
algorithm either ensures that all layers are always listed in a consistent relative import
priority order, or else it raises an exception reporting the relative priority conflict.</p>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">Wikipedia article on C3 linearization</a>
includes additional details on the C3 algorithm and the assurances it provides.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.4.0: </span>In previous versions, frameworks were not permitted to declare dependencies on other
framework layers, so linearization was not required.</p>
</div>
</section>
<section id="layer-names-and-versioning">
<span id="layer-names"></span><h3>Layer names and versioning<a class="headerlink" href="#layer-names-and-versioning" title="Link to this heading">¶</a></h3>
<p>Regardless of how a layer is versioned, the layer name is used directly
(with no additional prefix or suffix) when referring to the layer as a
dependency in another layer specification.</p>
<p>The layer name is also used directly (in combination with the <a class="reference internal" href="../glossary/#term-layer-type"><span class="xref std std-term">layer type</span></a>
prefix) for the following purposes:</p>
<ul class="simple">
<li><p>the name of the layer build environment</p></li>
<li><p>the name of the layer requirements file folder</p></li>
<li><p>as part of the name of the transitively locked layer requirements files</p></li>
<li><p>as the base name for the layer environment metadata file emitted when
publishing or exporting the environment</p></li>
<li><p>as the <code class="docutils literal notranslate"><span class="pre">layer_name</span></code> field in the generated layer metadata</p></li>
</ul>
<p>Runtime layers do not have a layer type prefix, while framework and application
layers use <code class="docutils literal notranslate"><span class="pre">app-*</span></code> and <code class="docutils literal notranslate"><span class="pre">framework-*</span></code> respectively.</p>
<p>Layers with implicit lock versioning disabled use their layer name directly
(in combination with their <a class="reference internal" href="../glossary/#term-layer-type"><span class="xref std std-term">layer type</span></a> prefix) for the following purposes:</p>
<ul class="simple">
<li><p>the name of the deployed layer environment when publishing artifacts or
locally exporting environments</p></li>
<li><p>as the <code class="docutils literal notranslate"><span class="pre">install_target</span></code> field in the generated layer metadata</p></li>
<li><p>when referring to the layer as a dependency in another layer’s deployment
configuration and output metadata</p></li>
</ul>
<p>Layers with implicit lock versioning enabled will instead use
<code class="docutils literal notranslate"><span class="pre">&quot;{layer_name}&#64;{lock_version}&quot;</span></code> for these deployment related purposes.</p>
</section>
<section id="source-tree-content-filtering">
<span id="id1"></span><h3>Source tree content filtering<a class="headerlink" href="#source-tree-content-filtering" title="Link to this heading">¶</a></h3>
<p>Application layer launch modules and support modules may be either single
files or directories defining a Python import package. In the latter
case, the contents of the source tree are filtered to exclude unwanted files
rather than including every file in the specified directory.</p>
<p>When git source control information is available, any files explicitly
excluded from source control will also be omitted from the application
layers (that is, the exclusions are based on <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> patterns).
Any files or folders with names starting with <code class="docutils literal notranslate"><span class="pre">.git</span></code> are also excluded.</p>
<p>If no recognised source control information is found, the source tree
content filtering defaults to simply excluding <code class="docutils literal notranslate"><span class="pre">__pycache__</span></code> folders
(as these may be generated if the launch modules or support modules are
imported for testing purposes from their source tree location).</p>
</section>
<section id="deprecated-fields">
<h3>Deprecated fields<a class="headerlink" href="#deprecated-fields" title="Link to this heading">¶</a></h3>
<p>The following field names were previously supported and now emit <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#FutureWarning" title="(in Python v3.13)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FutureWarning</span></code></a>
when used in a loaded stack specification:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">build_requirements</span></code>: no longer has any effect (rendered non-functional before
<a class="reference internal" href="../changelog/#changelog-0-1-0rc1"><span class="std std-ref">0.1.0rc1</span></a>, warning emitted from <a class="reference internal" href="../changelog/#changelog-0-2-0"><span class="std std-ref">0.2.0</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fully_versioned_name</span></code>: renamed to <code class="docutils literal notranslate"><span class="pre">python_implementation</span></code> in <a class="reference internal" href="../changelog/#changelog-0-2-0"><span class="std std-ref">0.2.0</span></a></p></li>
</ul>
</section>
</section>
<section id="locked-layer-requirements">
<span id="layer-requirements"></span><h2>Locked layer requirements<a class="headerlink" href="#locked-layer-requirements" title="Link to this heading">¶</a></h2>
<p>Environment lock metadata files saved alongside the layer’s transitively locked requirements file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requirements_hash</span><span class="p">:</span> <span class="nb">str</span>   <span class="c1"># Uses &quot;algorithm:hexdigest&quot; format</span>
<span class="n">lock_input_hash</span><span class="p">:</span> <span class="nb">str</span>     <span class="c1"># Uses &quot;algorithm:hexdigest&quot; format</span>
<span class="n">other_inputs_hash</span><span class="p">:</span> <span class="nb">str</span>   <span class="c1"># Uses &quot;algorithm:hexdigest&quot; format</span>
<span class="n">version_inputs_hash</span><span class="p">:</span> <span class="nb">str</span> <span class="c1"># Uses &quot;algorithm:hexdigest&quot; format</span>
<span class="n">lock_version</span><span class="p">:</span> <span class="nb">int</span>        <span class="c1"># Auto-incremented from previous lock metadata</span>
<span class="n">locked_at</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># ISO formatted date/time value</span>
</pre></div>
</div>
<p>Note: A future documentation update will cover these <code class="docutils literal notranslate"><span class="pre">venvstacks</span> <span class="pre">lock</span></code> output files in additional detail.</p>
</section>
<section id="deployed-layer-configuration">
<span id="deployed-layer-config"></span><h2>Deployed layer configuration<a class="headerlink" href="#deployed-layer-configuration" title="Link to this heading">¶</a></h2>
<p>Deployed layer configuration files saved as <code class="docutils literal notranslate"><span class="pre">share/venv/metadata/venvstacks_layer.json</span></code> in the layer
environments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span><span class="p">:</span> <span class="nb">str</span>                      <span class="c1"># Relative path to this layer&#39;s Python executable</span>
<span class="n">py_version</span><span class="p">:</span> <span class="nb">str</span>                  <span class="c1"># Expected X.Y.Z Python version for this environment</span>
<span class="n">base_python</span><span class="p">:</span> <span class="nb">str</span>                 <span class="c1"># Relative path from layer dir to base Python executable</span>
<span class="n">site_dir</span><span class="p">:</span> <span class="nb">str</span>                    <span class="c1"># Relative path to site-packages within this layer</span>
<span class="n">pylib_dirs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>        <span class="c1"># Relative paths to additional sys.path entries</span>
<span class="n">dynlib_dirs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>       <span class="c1"># Relative paths to additional Windows DLL directories</span>
<span class="n">launch_module</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Module to run with `-m` to launch the application</span>
</pre></div>
</div>
<p>Primarily used by the post-installation script to finish setting up the environment after deployment.
May also be used by the containing application to find the Python executable location for that platform.</p>
<p>All relative paths are relative to the layer folder (and may refer to peer folders).
Base runtime layers will have <code class="docutils literal notranslate"><span class="pre">python</span></code> and <code class="docutils literal notranslate"><span class="pre">base_python</span></code> set to the same value.
Application layers will have <code class="docutils literal notranslate"><span class="pre">launch_module</span></code> set.</p>
<p>Note: A future documentation update will cover these <code class="docutils literal notranslate"><span class="pre">venvstacks</span> <span class="pre">build</span></code> output files in additional detail.</p>
</section>
<section id="published-layer-metadata">
<span id="layer-metadata"></span><h2>Published layer metadata<a class="headerlink" href="#published-layer-metadata" title="Link to this heading">¶</a></h2>
<p>Layer output metadata files saved to the <code class="docutils literal notranslate"><span class="pre">__venvstacks__</span></code> metadata folder when publishing
layer archives or locally exporting layer environments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common fields defined for all layers, whether archived or exported</span>
<span class="n">layer_name</span><span class="p">:</span> <span class="n">EnvNameBuild</span>       <span class="c1"># Prefixed layer name without lock version info</span>
<span class="n">install_target</span><span class="p">:</span> <span class="n">EnvNameDeploy</span>  <span class="c1"># Target installation folder when unpacked</span>
<span class="n">requirements_hash</span><span class="p">:</span> <span class="nb">str</span>         <span class="c1"># Uses &quot;algorithm:hexdigest&quot; format</span>
<span class="n">lock_version</span><span class="p">:</span> <span class="nb">int</span>              <span class="c1"># Monotonically increasing version identifier</span>
<span class="n">locked_at</span><span class="p">:</span> <span class="nb">str</span>                 <span class="c1"># ISO formatted date/time value</span>

<span class="c1"># Fields that are populated after the layer metadata has initially been defined</span>
<span class="c1"># &quot;runtime_layer&quot; is set to the underlying runtime&#39;s deployed environment name</span>
<span class="c1"># &quot;python_implementation&quot; is set to the underlying runtime&#39;s implementation name</span>
<span class="c1"># &quot;bound_to_implementation&quot; means that the layered environment includes</span>
<span class="c1"># copies of some files from the runtime implementation, and hence will</span>
<span class="c1"># need updating even for runtime maintenance releases</span>
<span class="n">runtime_layer</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="n">python_implementation</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="n">bound_to_implementation</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>

<span class="c1"># Extra fields only defined for framework and application environments</span>
<span class="n">required_layers</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">EnvNameDeploy</span><span class="p">]]</span>

<span class="c1"># Extra fields only defined for application environments</span>
<span class="n">app_launch_module</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="n">app_launch_module_hash</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</pre></div>
</div>
<p>Additional metadata fields only included when publishing layer archives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">archive_build</span><span class="p">:</span> <span class="nb">int</span>    <span class="c1"># Auto-incremented from previous build metadata</span>
<span class="n">archive_name</span><span class="p">:</span> <span class="nb">str</span>     <span class="c1"># Adds archive file extension to layer name</span>
<span class="n">target_platform</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Target platform identifier</span>
<span class="n">archive_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">archive_hashes</span><span class="p">:</span> <span class="n">ArchiveHashes</span> <span class="c1"># Mapping from hash algorithm names to hashes</span>
</pre></div>
</div>
<p>Hashes of layered environment dependencies are intentionally NOT incorporated
into the published metadata. This allows an “only if needed” approach to
rebuilding app and framework layers when the layers they depend on are
updated (app layers will usually only depend on some of the components in the
underlying environment, and such dependencies are picked up as version changes
when regenerating the transitive dependency specifications for each environment).</p>
<dl class="simple">
<dt>Note: A future documentation update will cover the <code class="docutils literal notranslate"><span class="pre">venvstacks</span> <span class="pre">publish</span></code> and</dt><dd><p><code class="docutils literal notranslate"><span class="pre">venvstacks</span> <span class="pre">local-export</span></code> output metadata files in additional detail,
including the effects of the <code class="docutils literal notranslate"><span class="pre">--tag-outputs</span></code> option when publishing.</p>
</dd>
</dl>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../design/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Design Discussion</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../glossary/">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Essential Terms and Concepts</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Element Labs Inc.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Environment Stack File Formats</a><ul>
<li><a class="reference internal" href="#file-naming-and-formats">File naming and formats</a></li>
<li><a class="reference internal" href="#defining-virtual-environment-stacks">Defining virtual environment stacks</a><ul>
<li><a class="reference internal" href="#common-layer-specification-fields">Common layer specification fields</a></li>
<li><a class="reference internal" href="#runtime-layer-specification-fields">Runtime layer specification fields</a></li>
<li><a class="reference internal" href="#framework-layer-specification-fields">Framework layer specification fields</a></li>
<li><a class="reference internal" href="#application-layer-specification-fields">Application layer specification fields</a></li>
<li><a class="reference internal" href="#linearizing-the-python-import-path">Linearizing the Python import path</a></li>
<li><a class="reference internal" href="#layer-names-and-versioning">Layer names and versioning</a></li>
<li><a class="reference internal" href="#source-tree-content-filtering">Source tree content filtering</a></li>
<li><a class="reference internal" href="#deprecated-fields">Deprecated fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#locked-layer-requirements">Locked layer requirements</a></li>
<li><a class="reference internal" href="#deployed-layer-configuration">Deployed layer configuration</a></li>
<li><a class="reference internal" href="#published-layer-metadata">Published layer metadata</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=adf8fbb0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>